---
title: 安装教程
---

## 一、下载文件

在开始安装之前，要提前下载好这些文件：

1. mcpatch-manager.exe：这是管理端，用来打更新包
2. mcpatch-client.exe：这是客户端，用来更新下载更新文件

:::tip

如果运行的时候，提示找不到 VCRUNTIME140.dll 文件。请参考[这里](../faq.md#由于找不到VCRUNTIME140.dll，无法继续执行代码)安装 VC++ 2015 运行库。

:::

## 二、配置管理端

管理端是用来打包和管理更新包的工具，同时也提供一个内置的服务端功能，提供开箱即用的下载体验。

将管理端放到一个新建的目录mp中，然后双击`mcpatch-manager.exe`启动管理端。

可以看到有`> `的字样，此时进入了交互式命令行模式。按回车就可以出现命令提示。

因为是第一次，我们在交互式命令行模式下输入`check`命令，它会提示修改的文件数量为0，我们先忽略这个信息。

更重要的是，此时管理端会为我们创建好工作空间目录workspace，这样管理端就配置好了，我们也有地方可以放要更新的文件了。

## 三、放入要更新的文件

只把需要更新的文件放到工作空间目录里，暂时不更新的文件可以以后再放，能减少更新包的大小。

同时工作空间目录下的文件要和客户端保持相同的目录结构。

下面一些栗子可以参考（不存在的文件夹需要手动创建）：

+ 要更新所有模组，复制`.minecraft/mods`目录
  + 到`mp/workspace/.minecraft/mods`

+ 要更新.minecraft目录旁边的`新玩家进服教程.txt`，复制`新玩家进服教程.txt`文件
  + 到`mp/workspace/新玩家进服教程.txt`

+ 如果你开了版本隔离，就需要复制`.minecraft/versions/your-version/mods`目录
  + 到`mp/workspace/.minecraft/versions/your-version/mods`
  + 其它文件也是同理，需要复制到versions目录下

:::tip

若开启版本隔离，那么要更新的实际上是versions目录下的mods文件夹。如果直接把文件放到`.minecraft/mods`目录下，游戏是读取不到的。

:::

## 四、开始打包

双击`mcpatch-manager.exe`启动管理端，进入交互式命令行模式。

看到`> `的字样后。输入`pack <version>`即可开始打包，`<version>`是要打包的版本号，不能和现有的重复。

版本号只能包括大小写字母，数字，以及`!@#$()_+-=;',.`这几个符号，不要使用中文，空格，或其它字符，会出问题。

如果你想给这个版本增加更新记录的话，把更新记录写在管理端目录的`logs.txt`文件里就会自动读取到了（使用utf-8编码）。

看到“打包完成！”的字样即代表打包成功了，更新包会存放在public目录下，会按版本号进行命名。

如果对打包结果不放心，可以使用`test`对更新包进行校验，这会模拟客户端的解压过程，检查文件是否损坏。

:::danger[万分小心！！！]

已经打好的更新包文件不能手动删除也不能修改里面的文件，这会导致数据损坏，应该再打一个新的包来替代删除旧的包。

:::

## 五、后续打包

后续的文件维护很简单，直接对工作空间目录下的文件或者目录进行增加，删除，修改即可，修改完后输入pack打包。

管理端会自动识别到你所做的更改，并记录到更新包里。

即使新旧文件同名，只修改了文件里的数据，也能检测到（包括加密压缩包）。目录也是一样，该新增新增，该删除删除，就像对自己电脑上的文件一样操作就好。

如果对工作空间目录下的文件进行了修改，但又发现改的不对。可以使用管理端的revert命令来丢弃刚刚的修改，将文件状态退回上一次打包的时候。

## 六、启动服务端

启动管理端后，使用`serve 6700`可以启动内置的服务端，默认端口是6700。

想要关闭服务端可以叉掉终端的窗口，或者按Ctrl + C即可。

如果需要从bat调用启动内置服务端的话可以这样写`mcpatch-manager.exe serve 6700`。

（一般都是同时开两个管理端进程实例，一个打包用，用完叉掉。一个跑内置服务端，一直挂在后台）

内置的服务端使用基于TCP的私有协议，不是http不用担心备案问题，适合小服或者本地调试环境。

## 七、配置客户端

将客户端程序放到Minecraft客户端的`.minecraft/gengxin`目录里面（需要手动创建），然后直接双击运行。

不出意外的话，客户端会报错无法连接，不用管这个报错直接关掉。

此时它会生成配置文件`mcpatch.yml`，我们需要打开编辑。

唯一需要修改的是`urls`选项，这个参数控制更新服务器的地址，将127.0.0.1:6700修改成自己服务器的ip和端口即可。

其它选项可以按需修改。

## 八、一键启动

每次都要手动运行更新很麻烦，可以借助一些方法在游戏启动时自动进行更新。

首先到[BalloonUpdate/McPatch2Loader](https://github.com/BalloonUpdate/McPatch2Loader/releases)下载最新版的加载器文件。

再放到`.minecraft/gengxin`目录里面，和客户端程序放到一起。

再在此处创建“启动列表”文件，叫`startlist.txt`。

将客户端程序的文件名复制，比如`mcpatch-client-0.0.0.exe`。粘贴到`startlist.txt`里，保存关闭。

打开Minecraft启动器（任意启动器均可，官方启动器除外），调整游戏版本设置，找到Java虚拟机参数（或者JVM 参数）。

在参数的开头插入这串代码`-javaagent:gengxin/《举个栗子》.jar `（注意jar后面还有个空格也不要漏），然后回到启动器主界面。

《举个栗子》要换成loader.jar的实际文件名，这里只是举例，下文同理。

点击Minecraft启动器的“启动游戏”按钮，一切顺利的话就会自动启动更新了。

如果启动游戏提示`Error opening zip file or JAR manifest missing`。

可以试试将参数换成这个：`-javaagent:../../gengxin/《举个栗子》.jar `，这样多加一个`../../`。尤其是启动器开启版本隔离后，特别有效。

## 九、经常被问到的问题

### 文件更新位置

客户端程序会自动搜索.minecraft的父目录作为更新起始位置，到处移动客户端程序不会影响文件更新位置。

如果要调整这个机制，可以修改配置文件里的`base-path`选项

### 删除管理端不存在的文件

客户端有些文件不在工作空间目录中，但又想删掉这个文件，可以在工作空间目录创建一个同路径且同名的空文件。

打一个更新包，然后再将这些文件删掉，再打一个包，客户端就可以正常删除这些不存在的文件了。

### 版本号不是判断版本新旧的依据

版本号只是一个普通的标签，是给人类看的，程序不会解析对比版本号的文字，也不作为任何判断版本前后的依据。

版本号的判断顺序的按打包时间来计算的，后打的版本总是新版本。
