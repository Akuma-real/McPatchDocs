---
sidebar_position: 30
title: 客户端热升级
---

Mcpatch客户端会不定时发布新版本，新版本一般都会包含新的特性和改进修复，需要尽可能升级到新版本。

但客户端升级不像管理端那么容易：因为客户端在玩家电脑上，升级需要重新发包，比较麻烦。

因此Mcpatch特别支持了客户端热升级功能，用来远程下发新的客户端版本，无需重新发包。

客户端热升级的原理，是通过修改loader.jar的配置文件startlist.txt，来实现启动新版的客户端exe文件来做到热升级的。

## 首次配置

这部分步骤只需要进行一次即可，后续不用再做：

将下面的文件放入工作空间目录，以加入更新。并且文件位置要和客户端那边一一对应

1. startlist.txt文件
2. 当前版本的客户端程序文件

## 升级过程

1. 下载好新版本的客户端程序文件
2. 删除工作空间目录下的旧版客户端程序文件
3. 将新版的客户端程序文件放入旧版文件的旁边（工作空间目录里）
4. 编辑startlist.txt文件
5. 将新版的文件名，插入到第一行。使旧版的文件名从第一行变成第二行。以此类推，不要删除这些旧文件名
6. 将刚刚的修改正常打包，客户端程序会自动下载。等到下一次运行时，启动的就会是新版的客户端程序了

## startlist.txt文件的格式（可选阅读）

startlist.txt文件也叫启动列表文件，是加载器jar的配置文件。

加载器会读取这个文件内容，并将第一行的文件名，作为客户端程序的启动文件名，去运行这个文件，从而启动客户端程序。

而从第二行开始往后，记录的则是旧版的文件名，只有第一行是最新的版本。这些旧版文件名要保留，不能删除，否则玩家那边的旧版客户端程序文件会有残留，多占一些存储空间。（只是多占用一些空间，但不会对程序功能有干扰）

一个栗子：

```txt
mcpatch-1.4.exe  # 第一行是新版本
mcpatch-1.3.exe  # 第二行开始后面全是旧版本
mcpatch-1.2.exe  # 也是旧版本
mcpatch-1.1.exe  # 也是旧版本
```

为什么要这样做，是因为按照正常打包更新流程，更新包中有2个请求。

一个记录是下载新版的文件。

另一个记录是删除旧版文件。

下载新版文件没有任何问题，会直接下载。但是删除旧版文件时就会有些不同，此时客户端程序自己就是那个旧版文件。

按照Windows操作系统的规则，正在运行的文件是不能删除的，所以客户端无奈只能将删除“自己文件”这个请求给忽略掉，或者说跳过了。

那么就会造成旧版客户端文件一直残留，随着版本更新文件会越来越多。

既然客户端程序无法自己删除自己，那么就可以将这个删除请求委托给加载器来做。

加载器会将启动列表文件的第二行开始到末尾的所有文件名当成旧文件来处理，即删除掉。

这也是为什么需要保留这些旧版本文件列表的原因了。

就算将这些旧版文件名不小心删掉了，也不会有特别严重的后果。顶多就是占点空间，不会对功能有干扰。